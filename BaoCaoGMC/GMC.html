<!DOCTYPE html>
<html lang="vi">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Báo cáo GMC</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet">
    <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="../auth.css">
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
      /* THAY ĐỔI CSS - Chỉ ẩn ban đầu, không dùng !important */
/* .btn.btn-primary {
    display: none;
} */

/* Khi có class show thì hiển thị */
.btn.btn-primary.show {
    display: inline-block !important;
}


    .progress,
    .progress-stacked {
      display: flex;
      height: var(--bs-progress-height);
      overflow: hidden;
      font-size: var(--bs-progress-font-size);
      background-color: #bfbfbf;
      border-radius: var(--bs-progress-border-radius);
    }

    /* Đảm bảo không wrap chữ trong các ô */
    .text-nowrap {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .dropdown-menu {
      z-index: 2000 !important;
    }

    .stop-reason-box {
    border: 2px solid #dc3545 !important;
    background-color: #fff5f5 !important;
}

.stop-reason-box h5 {
    color: #dc3545 !important;
    font-weight: bold;
}


#btnYes, #btnNo {
    cursor: pointer !important;
    pointer-events: auto !important;
    user-select: none;
    min-width: 80px;
    font-weight: bold;
    border: 2px solid transparent !important;
    transition: all 0.2s ease;
}

#btnYes:hover, #btnNo:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.3) !important;
}


  </style>
  </head>

  <body class="bg-light p-4">

    <!-- Tab Nav -->
    <nav>
      <div class="nav nav-tabs justify-content-center" id="nav-tab"
        role="tablist" style="font-size: 20px;">
        <button class="nav-link active" id="nav-baocaogmc-tab"
          data-bs-toggle="tab" data-bs-target="#nav-baocaogmc"
          type="button" role="tab" aria-controls="nav-baocaogmc"
          aria-selected="true">Báo Cáo GMC</button>
        <button class="nav-link" id="nav-danhsachgmc-tab" data-bs-toggle="tab"
          data-bs-target="#nav-danhsachgmc"
          type="button" role="tab" aria-controls="nav-danhsachgmc"
          aria-selected="false">Báo cáo sản xuất</button>
        <button class="nav-link" id="nav-dungmaygmc-tab" data-bs-toggle="tab"
          data-bs-target="#nav-dungmaygmc"
          type="button" role="tab" aria-controls="nav-dungmaygmc"
          aria-selected="false">Báo cáo dừng máy</button>

      </div>

      <!-- Content tab -->
    </nav>

    <!-- Phần báo cáo -->
    <div class="tab-content" id="nav-tabContent">
      <div class="tab-pane fade show active" id="nav-baocaogmc" role="tabpanel"
        aria-labelledby="nav-baocaogmc-tab"
        tabindex="0">

        <!-- Bắt đầu báo cáo -->
        <div
          class="container bg-white p-4 rounded shadow position-relative border border-success rounded-top p-3 mt-5 "
          style="border-width: 2px;">

          <div class="d-flex justify-content-end mb-3">
            <button type="button" id="btnResetForm" class="btn btn-warning">
              <i class="fas fa-sync-alt me-1"></i> Chạy lại phiếu
            </button>
          </div>

          <div
            class="position-absolute start-50 translate-middle-x px-3 py-1 bg-white border border-primary rounded-pill"
            style="top: -30px;">
            <strong style="font-size: 30px;">MÁY : <span
                id="displayMachineName"></span></strong>
          </div>

          <div class="row g-2">

            <!-- Chọn máy -->
            <!-- <div class="col-md-4">
              <div class="form-floating mb-3" style="flex: 1 0 0%;">
                <select class="form-select" id="may" required
                  style="border: 1px solid blue; font-weight: bold;">
                  <option value selected>-- Chọn máy --</option>
                  <option value="GMC 1">GMC 1</option>
                  <option value="GMC 2">GMC 2</option>
                </select>
                <label for="may">Máy</label>
              </div>
            </div> -->

            <div class="col-md-4">
              <!-- Ca + Người -->
              <div class="d-flex gap-2 mb-3">
                <div class="form-floating" style="flex: 1 0 0%;">
                  <select class="form-select" id="ca" required
                    style="border: 1px solid blue; font-weight: bold;">
                    <option value selected>-- Chọn ca --</option>
                    <option value="0">Ca A</option>
                    <option value="1">Ca B</option>
                    <option value="2">Ca HC</option>
                  </select>
                  <label for="ca">Ca</label>
                </div>
              </div>
            </div>

            <div class="col-md-4">
              <!-- GIờ làm việc -->
              <div class="d-flex gap-2 mb-3">
                <div class="form-floating" style="flex: 1 0 0%;">
                  <select class="form-select" id="gioLamViec" required
                    style="border: 1px solid blue; font-weight: bold;">
                    <option value selected>-- Giờ làm việc --</option>
                    <option value="0">6H - 14H</option>
                    <option value="1">14H - 22H</option>
                    <option value="2">22H - 6H</option>
                    <option value="3">10H - 22H</option>
                    <option value="4">6H - 18H</option>
                    <option value="5">18H - 6H</option>
                    <option value="6">7H - 16H</option>
                    <option value="7">7H -15H</option>
                    <option value="8">7H - 17H</option>
                    <option value="9">8H - 17H</option>
                  </select>
                  <label for="gioLamViec">Giờ làm việc</label>
                </div>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-floating flex-grow-1 disabled ">
                <input type="text" class="form-control " id="maCa"
                  disabled style="border: 1px solid blue; font-weight: bold;">
                <label for="maCa">Mã Ca</label>
              </div>
            </div>

          </div>

          <div class="row g-4">

            <!-- Cột Trái -->
            <div class="col-md-6">

              <!-- Số phiếu cắt giấy-->
              <div class="form-floating mb-3">
                <input type="text" class="form-control" id="soPhieu"
                  placeholder="Số phiếu Cắt giấy" value="PCG">
                <label for="soPhieu">Số phiếu Cắt giấy</label>
              </div>

              <div class="form-floating mb-3">
                <input type="text" class="form-control" id="ws"
                  placeholder="Số WS" disabled style="color: blue;">
                <label for="ws">Số WS</label>
              </div>

              <div class="form-floating mb-3">
                <input type="text" class="form-control" id="maVatTu"
                  placeholder="Mã vật tư" disabled
                  style="color: blue;" data-dinh-luong>
                <label for="maVatTu">Mã vật tư</label>
              </div>

              <!-- Thêm trường định lượng ẩn nếu cần -->
              <input type="hidden" id="dinhLuong" value>

              <div class="form-floating mb-3">
                <input type="text" class="form-control" id="kho"
                  placeholder="Khổ" disabled
                  style="color: blue;">
                <label for="kho">Khổ</label>
              </div>

              <div class="mb-3">
                <label class="form-label fw-bold">Mã số cuộn</label>
                <div class="mb-2">
                  <select class="form-select" id="maSoCuonSelect">
                    <option value selected>-- Chọn mã số cuộn --</option>
                    <option value="TƯƠNG TỰ CUỘN TRÊN">TƯƠNG TỰ CUỘN
                      TRÊN</option>
                    <option value="GIẤY KH CUNG CẤP">GIẤY KH CUNG CẤP</option>
                    <option value="KHÔNG CÓ MÃ SỐ CUỘN">KHÔNG CÓ MÃ SỐ
                      CUỘN</option>
                    <option value="nhap">Nhập mã số cuộn...</option>
                  </select>
                </div>
                <div id="maSoCuonInputContainer" style="display: none;">
                  <input type="text" id="maSoCuon" class="form-control"
                    placeholder="Nhập mã số cuộn...">
                </div>
              </div>

            </div>

            <!-- Cột Phải -->
            <div class="col-md-6">

              <!-- Thứ tự -->
              <div class="form-floating mb-3">
                <select class="form-select" id="thuTu">
                  <option selected>-- Thứ tự --</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                </select>
                <label for="thuTu">Thứ tự</label>
              </div>

              <div class="form-floating mb-3">
                <input type="text" class="form-control" id="khachhang"
                  placeholder="Khách hàng" disabled
                  style="color: blue;">
                <label for="khachhang">Khách hàng</label>
              </div>

              <div class="form-floating mb-3">
                <input type="text" class="form-control" id="soto"
                  placeholder="Số tờ/pallet" disabled
                  style="color: blue;">
                <label for="soto">Số tờ/pallet</label>
              </div>

              <div class="form-floating mb-3">
                <input type="text" class="form-control" id="dai"
                  placeholder="Dài" disabled
                  style="color: blue;">
                <label for="dai">Dài</label>
              </div>

              <div class="mb-3">
                <label class="form-label fw-bold">Trọng lượng nhận (kg)</label>
                <input type="text" class="form-control" id="tln"
                  placeholder="Trọng lượng nhận (kg)">
              </div>

            </div>

          </div>

          <div class="row g-3 mb-4">
            <div class="col-md-4 py-3">
              <label class="form-label fw-bold">Xả đôi</label>
              <div class="mb-2">
                <select class="form-select" id="xadoiSelect">
                  <option value selected>-- Tùy chọn --</option>
                  <option value="0">0 - Không xả đôi trên máy</option>
                  <option value="1">1 - Xả đôi trên máy</option>
                </select>
              </div>
            </div>
            <div
              class="col-md-4 py-3 d-flex align-items-center justify-content-around">
              <div class="d-block">
                <div class="d-flex">
                  <input type="checkbox" name id="chuyenXen">
                  <label class="form-label fw-bold ms-2"
                    style="color: blue;">Chuyển xén</label>
                </div>
                <small class="text-muted">Nếu cắt xong chuyển xén</small>
              </div>
              <div class="d-block">
                <div class="d-flex">
                  <input type="checkbox" name id="giayQuanLot">
                  <label class="form-label fw-bold ms-2"
                    style="color: blue;">Giấy quấn/lót</label>
                </div>
                <small class="text-muted">Nếu cắt giấy gót/giấy lót</small>
              </div>
            </div>
            <div class="col-md-4 py-3">
              <label class="form-label fw-bold">Số ID (8 số)</label>

              <div class="form-check">
                <input class="form-check-input" type="radio" name="chonSoID"
                  id="khongCoID" value="none" checked>
                <label class="form-check-label" for="khongCoID">
                  Không có số ID
                </label>
              </div>

              <div class="form-check mb-2">
                <input class="form-check-input" type="radio" name="chonSoID"
                  id="nhapSoID" value="input">
                <label class="form-check-label" for="nhapSoID">
                  Nhập số ID (8 số)
                </label>
              </div>

              <input type="text" id="inputSoID" class="form-control mb-1"
                placeholder="Nhập số ID" maxlength="10"
                disabled>
              <small class="text-muted">Ví dụ: GC12345678 hoặc GS12345678 (dãy
                trên tem thể hiện)</small>
            </div>
          </div>

          <div class="text-center">
            <strong>Thời gian bắt đầu :</strong> <span
              class="text-success fw-bold" id="startTime"></span>
          </div>

          <!-- Nút và Tiến độ -->
          <div class="text-center mt-2">
            <div class="text-success fw-bold mb-2"></div>
            <div class="d-flex justify-content-between align-items-center">
              <div style="width: 100%;">
                <div class="progress" style="height: 10px;">
                  <div class="progress-bar bg-success" role="progressbar"
                    style="width: 0%;" aria-valuenow="0"
                    aria-valuemin="0" aria-valuemax="100"></div>
                </div>
              </div>
              <span class="ms-2"></span>
            </div>
            <button class="btn btn-success px-5 mt-3">Bắt Đầu</button>
          </div>

        </div>

        <!-- Phần kết thúc báo cáo -->

        <div
          class="container bg-white p-4 rounded shadow position-relative border border-danger rounded-top p-3 mt-5"
          style="border-width: 2px;">

          <div class="row g-5">
            <div class="col-md-4">
              <div class="mb-3">
                <label class="fw-bold">Tổng số pallet</label>
                <input type="number" class="form-control bg-white"
                  id="tongSoPallet" required>
              </div>
              <div class="mb-3">
                <label class="fw-bold">Lõi (kg)</label>
                <input type="number" class="form-control bg-white" id="loi">
              </div>
              <div class="mb-3">
                <label class="fw-bold">Phế liệu sản xuất (kg)</label>
                <input type="number" class="form-control bg-white"
                  id="pheLieuSanXuat">
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label class="fw-bold">Số tấm cắt được</label>
                <input type="text" class="form-control bg-white"
                  id="soTamCatDuoc">
              </div>
              <div class="mb-3">
                <label class="fw-bold">Đầu cuộn (kg)</label>
                <input type="number" class="form-control bg-white" id="dauCuon">
              </div>
              <div class="mb-3">
                <label class="fw-bold">Rách móp (kg)</label>
                <input type="number" class="form-control bg-white" id="rachMop">
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label class="fw-bold">TL trả (kg)</label>
                <input type="number" class="form-control bg-white" id="tlTra">
              </div>
              <div class="mb-3">
                <label class="fw-bold">Sử dụng giấy tồn/tận dụng (tấm)</label>
                <input type="number" class="form-control bg-white"
                  id="suDungGiayTon">
              </div>
              <div class="mb-3">
                <label class="fw-bold">Chiều cao pallet (cm)</label>
                <input type="number" class="form-control bg-white"
                  id="chieuCaoPallet">
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-6">
              <div class="mb-3">
                <label class="fw-bold">Thời gian chuyển đổi pallet
                  (phút)</label>
                <input type="number" class="form-control bg-white"
                  id="thoiGianChuyenDoiPallet">
              </div>
              <div class="mb-3">
                <label class="fw-bold">Thời gian khác (phút)</label>
                <input type="number" class="form-control bg-white"
                  id="thoiGianKhac">
              </div>

            </div>
            <div class="col-6">
              <div class="mb-3">
                <label class="fw-bold" style="color: red;">TL trả dự
                  kiến</label>
                <input type="number" class="form-control" id="tlTraDuKien"
                  disabled>
              </div>
              <div class="mb-3">
                <label class="fw-bold" style="color: blue;">Số tấm tham
                  chiếu</label>
                <input type="number" class="form-control" id="soTamThamChieu"
                  disabled>
              </div>
            </div>
          </div>

          <div class="mb-3">
            <label class="fw-bold">Ghi chú</label>
            <textarea class="form-control bg-white" rows="2"
              id="ghiChu"></textarea>
          </div>

          <div class="row g-4">
            <div class="col-md-4">
              <div class="mb-3">
                <label class="fw-bold" style="color: red;">Khổ cắt sai
                  (mm)</label>
                <input type="number" class="form-control bg-white"
                  id="khoCatSai">
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label class="fw-bold" style="color: red;">Dài cắt sai
                  (mm)</label>
                <input type="number" class="form-control bg-white"
                  id="daiCatSai">
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label class="fw-bold" style="color: red;">Số tấm cắt
                  sai</label>
                <input type="number" class="form-control bg-white"
                  id="soTamCatSai">
              </div>
            </div>
          </div>

          <!-- <div class="row g-4">
          <div class="col-md-6">
            <div class="mb-3">
              <label class="fw-bold">Khổ xén (mm)</label>
              <input type="number" class="form-control bg-white" id="khoXen"> 
            </div>
          </div>
          <div class="col-md-6">
            <div class="mb-3">
              <label class="fw-bold">Dài xén (mm)</label>
              <input type="number" class="form-control bg-white" id="daiXen"> 
            </div>
          </div>
        </div> -->

          <!-- Dừng máy -->
          <div
            class="mt-4 mb-5 p-3 rounded d-flex align-items-center justify-content-between position-relative overflow-hidden"
            style="margin-top: 15px; background: linear-gradient(270deg, #D00000, #FF7272, #FFE0E0, #FF7272, #D00000); background-size: 500% 500%; animation: triColorGradient 4s ease infinite; box-shadow: 0 5px 15px rgba(208, 0, 0, 0.5); border: 2px solid #D00000; width: 80%; margin: 0 auto;">
            <div class="pulse-effect"></div>
            <div
              class="d-flex align-items-center justify-content-center position-relative"
              style="z-index: 2;">
              <span class="text-warning me-2"
                style="font-size: 1.5rem; animation: warningPulse 1s infinite;">⚠</span>
              <span class="text-white fw-bold"
                style="text-shadow: 2px 2px 4px rgba(0,0,0,0.5); font-size: 2.2rem; letter-spacing: 1px;">DỪNG
                MÁY</span>
            </div>
            <div class="d-flex position-relative" style="z-index: 2;">
              <button id="btnNo"
                class="btn border me-2 px-4 fw-bold"
                style="font-weight: bold;">KHÔNG</button>
              <button id="btnYes"
                class="btn btn-light border px-4 fw-bold"
                style="font-weight: bold;">CÓ</button>
            </div>
          </div>

          <!-- Phần Báo Cáo Dừng Máy -->
          <div class="mt-4 mb-4 p-3 border border-danger rounded machine-report"
            id="machineReport"
            style="width: 70%; margin: 0 auto; background-color: #FFC9CD;">
            <h5 class="text-center fw-bold mb-3">BÁO CÁO DỪNG MÁY</h5>

            <div class="row mb-3">
              <div class="col-4">
                <label class="fw-bold mb-1">Lý do dừng máy</label>
                <select class="form-select" id="stopReason">
                  <option value>-- Lý do --</option>
                  <option value="Máy hư">F1 : Máy hư</option>
                  <option value="Chờ giấy">F2 : Chờ giấy</option>
                  <option value="Chờ kế hoạch">F3 : Chờ kế hoạch</option>
                  <option value="Giải lao">F4 : Giải lao</option>
                  <option value="Vệ sinh">F5 : Vệ sinh</option>
                  <option value="Chờ hàng làm việc khác">F6 : Chờ hàng làm việc
                    khác</option>
                  <option value="Bảo dưỡng">F7 : Bảo dưỡng</option>
                  <option value="Cúp điện , mất hơi">F8 : Cúp điện, mất
                    hơi</option>
                  <option value="Lựa giấy">F9 : Lựa giấy</option>
                  <option value="Khác">F10 : Khác</option>
                </select>
              </div>

              <div class="col-4 time-inputs" style="display: none;">
                <label class="fw-bold mb-1">Thời gian dừng máy</label>
                <div class="position-relative">
                  <input type="datetime-local" class="form-control"
                    id="stopTimeInput">
                  <button
                    class="btn btn-primary position-absolute top-0 end-0 h-100"
                    id="stopTimeButton"
                    style="z-index: 20; opacity: 1; pointer-events: auto; cursor: pointer !important;">
                    Dừng máy
                  </button>
                </div>
                <div class="form-text" id="stopTimeDisplay"></div>
              </div>

              <div class="col-4 time-inputs" style="display: none;">
                <label class="fw-bold mb-1">Thời gian chạy lại</label>
                <div class="position-relative">
                  <input type="datetime-local" class="form-control"
                    id="resumeTimeInput">
                  <button
                    class="btn btn-success position-absolute top-0 end-0 h-100"
                    id="resumeTimeButton"
                    style="z-index: 10;">
                    Chạy lại
                  </button>
                </div>
                <div class="form-text" id="resumeTimeDisplay"></div>
              </div>
            </div>

            <div class="row mb-3 additional-fields" style="display: none;">
              <div class="col-8">
                <label class="fw-bold mb-1">Lý do khác</label>
                <input type="text" class="form-control"
                  placeholder="Nhập lý do..." id="otherReason">
              </div>
              <div class="col-4">
                <label class="fw-bold mb-1 text-primary">Thời gian dừng
                  máy</label>
                <input type="text" class="form-control bg-light"
                  id="stopDuration" readonly>
              </div>
            </div>

            <!-- Container cho các lý do bổ sung sẽ được thêm tại đây -->
            <div id="additionalReasonsContainer"></div>

            <button class="btn btn-danger me-3" id="submitStopOnlyButton"
              onclick="submitStopReportOnly()" style="display: none;">
              Dừng máy không có WS
            </button>
          </div>

          <div class="text-center mt-4">
            <button type="button" class="btn btn-primary px-5"
              id="confirmButton" style="display: none;">
              <i class="fas fa-check-circle me-2"></i>Xác nhận
            </button>
          </div>

        </div>

      </div>

      <!-- Phần danh sách báo cáo -->
      <div class="tab-pane fade" id="nav-danhsachgmc" role="tabpanel"
        aria-labelledby="nav-danhsachgmc-tab" tabindex="0">

        <div class="mx-5 bg-white p-4 rounded shadow mt-4 ">
          <h2 class="mb-4 text-success text-center">Danh sách báo cáo GMC</h2>

          <!-- Phần tìm kiếm và lọc -->
          <div class="row mb-4">
            <div class="col-md-3">
              <div class="input-group mb-2">
                <input type="text" class="form-control" id="searchInput"
                  placeholder="Tìm kiếm...">
                <button class="btn btn-outline-secondary" type="button"
                  id="btnSearch">
                  <i class="fas fa-search"></i>
                </button>
              </div>
              <div class>
                <select class="form-select mb-2" id="mayFilter">
                  <option value>-- Tất cả máy --</option>
                  <option value="GMC 1">GMC 1</option>
                  <option value="GMC 2">GMC 2</option>
                </select>
              </div>
            </div>
            <div class="col-md-4">
              <div class="date-filter-container border rounded p-2 mb-2">
                <div class="row g-2">
                  <div class="col-5">
                    <label for="startDateFilter"
                      class="form-label small mb-1">Từ ngày:</label>
                    <input type="datetime-local"
                      class="form-control form-control-sm" id="startDateFilter">
                  </div>
                  <div class="col-5">
                    <label for="endDateFilter" class="form-label small mb-1">Đến
                      ngày:</label>
                    <input type="datetime-local"
                      class="form-control form-control-sm" id="endDateFilter">
                  </div>
                  <div class="col-2">
                    <!-- <label class="form-label small mb-1">&nbsp;</label> -->
                    <div class="d-grid gap-1 ">
                      <button class="btn btn-primary btn-sm" id="btnDateFilter">
                        <i class="fas fa-filter"></i>
                      </button>
                      <button class="btn btn-outline-secondary btn-sm"
                        id="btnClearDateFilter">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Chọn số mục hiển thị -->
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
              <span>Hiển thị </span>
              <select id="itemsPerPage"
                class="form-select form-select-sm d-inline-block w-auto mx-1">
                <option value="10">10</option>
                <option value="20">20</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
              <span> mục</span>
              <button class="btn btn-success btn-sm ms-3" id="btnFixColumns">
                <i class="fas fa-thumbtack me-1"></i> Cố định cột
              </button>
            </div>
            <div class="d-flex justify-content-between align-items-center ">
              <div id="totalItems">Tổng số: 0 bản ghi</div>
            </div>

          </div>

          <!-- Bảng danh sách -->
          <div class="table-responsive">
            <table
              class="table table-striped table-hover table-bordered text-center">
              <thead class="table-light">
                <tr>
                  <th class="text-nowrap" style="min-width: 120px;">Thao
                    tác</th>
                  <th class="text-nowrap" style="min-width: 60px;">STT</th>
                  <th class="text-nowrap" style="min-width: 100px;">Ngày</th>
                  <th class="text-nowrap" style="min-width: 80px;">Ca</th>
                  <th class="text-nowrap" style="min-width: 250px;">Người
                    thực hiện</th>
                  <th class="text-nowrap" style="min-width: 100px;">Ngày
                    phụ</th>
                  <th class="text-nowrap" style="min-width: 100px;">Máy</th>
                  <th class="text-nowrap" style="min-width: 100px;">Giờ làm
                    việc</th>
                  <th class="text-nowrap" style="min-width: 70px;">Mã ca</th>
                  <th class="text-nowrap" style="min-width: 120px;">Số Phiếu
                    CG</th>
                  <th class="text-nowrap" style="min-width: 80px;">Số lần</th>
                  <th class="text-nowrap" style="min-width: 120px;">Số WS</th>
                  <th class="text-nowrap" style="min-width: 130px;">Khách
                    hàng</th>
                  <th class="text-nowrap" style="min-width: 250px;">Mã giấy</th>
                  <th class="text-nowrap" style="min-width: 120px;">Định
                    Lượng</th>
                  <th class="text-nowrap" style="min-width: 100px;">Số tấm</th>
                  <th class="text-nowrap" style="min-width: 100px;">Khổ cắt
                    (mm)</th>
                  <th class="text-nowrap" style="min-width: 180px;">Mã số
                    cuộn</th>
                  <th class="text-nowrap" style="min-width: 80px;">TLN</th>
                  <th class="text-nowrap" style="min-width: 200px;">TG BẮT
                    ĐẦU</th>
                  <th class="text-nowrap" style="min-width: 200px;">TG Kết
                    Thúc</th>
                  <th class="text-nowrap" style="min-width: 160px;">Khổ
                    (mm)</th>
                  <th class="text-nowrap" style="min-width: 160px;">Dài
                    (mm)</th>
                  <th class="text-nowrap" style="min-width: 100px;">Tổng số
                    pallet</th>
                  <th class="text-nowrap" style="min-width: 100px;">Số tấm cắt
                    được</th>
                  <th class="text-nowrap" style="min-width: 100px;">TL trả thực
                    tế (kg)</th>
                  <th class="text-nowrap" style="min-width: 100px;">TL trả dự
                    tính (kg)</th>
                  <th class="text-nowrap" style="min-width: 150px;">Lõi
                    (kg)</th>
                  <th class="text-nowrap" style="min-width: 100px;">Đầu cuộn
                    (kg)</th>
                  <th class="text-nowrap" style="min-width: 100px;">Rách móp
                    (kg)</th>
                  <th class="text-nowrap" style="min-width: 180px;">Phế liệu sản
                    xuất (Kg)</th>
                  <th class="text-nowrap" style="min-width: 100px;">Số cuộn</th>
                  <th class="text-nowrap" style="min-width: 150px;">Ghi chú</th>
                  <th class="text-nowrap" style="min-width: 120px;">Thứ tự
                    cuộn</th>
                  <th class="text-nowrap" style="min-width: 100px;">Xả đôi</th>
                  <th class="text-nowrap" style="min-width: 100px;">Số ID</th>
                  <th class="text-nowrap" style="min-width: 100px;">Khổ
                    (xén)</th>
                  <th class="text-nowrap" style="min-width: 100px;">Dài
                    (xén)</th>
                  <th class="text-nowrap" style="min-width: 100px;">Số tấm
                    xén</th>
                  <th class="text-nowrap" style="min-width: 180px;">Sử dụng giấy
                    tồn (tấm)</th>
                  <th class="text-nowrap" style="min-width: 140px;">Số
                    tờ/pallet</th>
                  <th class="text-nowrap" style="min-width: 180px;">Khổ cắt sai
                    (mm)</th>
                  <th class="text-nowrap" style="min-width: 180px;">Dài cắt sai
                    (mm)</th>
                  <th class="text-nowrap" style="min-width: 150px;">Số tấm cắt
                    sai</th>
                  <th class="text-nowrap" style="min-width: 150px;">Giấy
                    quấn/giấy lót</th>
                  <th class="text-nowrap" style="min-width: 150px;">Chuyển
                    xén</th>
                  <th class="text-nowrap" style="min-width: 150px;">Chiều cao
                    pallet</th>
                  <th class="text-nowrap" style="min-width: 150px;">Số tấm tham
                    chiếu</th>
                  <th class="text-nowrap" style="min-width: 170px;">Thời gian
                    chuyển đổi pallet</th>
                  <th class="text-nowrap" style="min-width: 150px;">Thời gian
                    khác</th>
                </tr>
              </thead>
              <tbody id="reportTableBody">
                <!-- Dữ liệu sẽ được hiển thị ở đây -->
              </tbody>
            </table>
          </div>

          <!-- Phân trang -->
          <div class="d-flex justify-content-between align-items-center mt-4">
            <div>
              <span id="pageInfo">Hiển thị 0-0 của 0</span>
            </div>
            <nav aria-label="Page navigation">
              <ul class="pagination" id="pagination">
                <li class="page-item">
                  <a class="page-link" href="#" id="firstPage">Trang đầu</a>
                </li>
                <li class="page-item">
                  <a class="page-link" href="#" id="prevPage">Trang trước</a>
                </li>
                <!-- Các nút trang số sẽ được thêm ở đây -->
                <li class="page-item">
                  <a class="page-link" href="#" id="nextPage">Trang sau</a>
                </li>
                <li class="page-item">
                  <a class="page-link" href="#" id="lastPage">Trang cuối</a>
                </li>
              </ul>
            </nav>
          </div>

          <button class="btn btn-primary btn-sm ms-2" id="btnExportExcel">
            <i class="fas fa-file-excel me-1"></i> Xuất Excel
          </button>
        </div>

      </div>

      <!-- Phần dừng máy của báo cáo -->
      <div class="tab-pane fade" id="nav-dungmaygmc" role="tabpanel"
        aria-labelledby="nav-dungmaygmc-tab" tabindex="0">

        <div class="mx-5 bg-white p-4 rounded shadow mt-4">
          <h2 class="mb-4 text-danger text-center">Danh sách báo cáo dừng
            máy</h2>

          <div class="row mb-4">
            <div class="col-md-3">
              <div class="input-group mb-2">
                <input type="text" class="form-control" id="stopSearchInput"
                  placeholder="Tìm kiếm...">
                <button class="btn btn-outline-secondary" type="button"
                  id="btnStopSearch">
                  <i class="fas fa-search"></i>
                </button>
              </div>
              <div class>
                <select class="form-select mb-2" id="stopMayFilter">
                  <option value>-- Tất cả máy --</option>
                  <option value="GMC 1">GMC 1</option>
                  <option value="GMC 2">GMC 2</option>
                </select>
              </div>
            </div>
            <div class="col-md-4">
              <div class="date-filter-container border rounded p-2 mb-2">
                <div class="row g-2">
                  <div class="col-5">
                    <label for="startStopDateFilter"
                      class="form-label small mb-1">Từ ngày:</label>
                    <input type="datetime-local"
                      class="form-control form-control-sm"
                      id="startStopDateFilter">
                  </div>
                  <div class="col-5">
                    <label for="endStopDateFilter"
                      class="form-label small mb-1">Đến
                      ngày:</label>
                    <input type="datetime-local"
                      class="form-control form-control-sm"
                      id="endStopDateFilter">
                  </div>
                  <div class="col-2 ">
                    <div class="d-grid gap-1 ">
                      <button class="btn btn-primary btn-sm"
                        id="btnStopDateFilter">
                        <i class="fas fa-filter"></i>
                      </button>
                      <button class="btn btn-outline-secondary btn-sm"
                        id="btnClearStopDateFilter">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Chọn số mục hiển thị -->
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
              <span>Hiển thị </span>
              <select id="itemsPerStopPage"
                class="form-select form-select-sm d-inline-block w-auto mx-1">
                <option value="10">10</option>
                <option value="20">20</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
              <span> mục</span>
            </div>
            <div id="totalStopItems">Tổng số: 0 bản ghi</div>
          </div>

          <!-- Bảng danh sách -->
          <div class="table-responsive">
            <table
              class="table table-striped table-hover table-bordered text-center">
              <thead class="table-light">
                <tr>
                  <th class="text-nowrap" style="min-width: 60px;">STT</th>
                  <th class="text-nowrap" style="min-width: 80px;">Máy</th>
                  <th class="text-nowrap" style="min-width: 80px;">Ca</th>
                  <th class="text-nowrap" style="min-width: 100px;">Người
                    thực hiện</th>
                  <th class="text-nowrap" style="min-width: 100px;">Giờ làm
                    việc</th>
                  <th class="text-nowrap" style="min-width: 90px;">Mã ca</th>
                  <th class="text-nowrap" style="min-width: 120px;">Số
                    Worksheet</th>
                  <th class="text-nowrap" style="min-width: 120px;">Số Phiếu
                    CG</th>
                  <th class="text-nowrap" style="min-width: 80px;">Thứ tự
                    cuộn</th>
                  <th class="text-nowrap" style="min-width: 180px;">Thời gian
                    dừng máy</th>
                  <th class="text-nowrap" style="min-width: 180px;">Thời gian
                    chạy lại</th>
                  <th class="text-nowrap" style="min-width: 180px;">Thời gian
                    dừng</th>
                  <th class="text-nowrap" style="min-width: 200px;">Lý do dừng
                    máy</th>
                  <th class="text-nowrap" style="min-width: 200px;">Ghi chú</th>
                  <th class="text-nowrap" style="min-width: 120px;">Thao
                    tác</th>
                </tr>
              </thead>
              <tbody id="stopReportTableBody">

              </tbody>
            </table>
          </div>

          <!-- Phân trang -->
          <div class="d-flex justify-content-between align-items-center mt-4">
            <div>
              <span id="stopPageInfo">Hiển thị 0-0 của 0</span>
            </div>
            <nav aria-label="Page navigation">
              <ul class="pagination" id="stopPagination">
                <li class="page-item">
                  <a class="page-link" href="#" id="firstStopPage">Trang đầu</a>
                </li>
                <li class="page-item">
                  <a class="page-link" href="#" id="prevStopPage">Trang
                    trước</a>
                </li>
                <!-- Các nút trang số sẽ được thêm ở đây -->
                <li class="page-item">
                  <a class="page-link" href="#" id="nextStopPage">Trang sau</a>
                </li>
                <li class="page-item">
                  <a class="page-link" href="#" id="lastStopPage">Trang cuối</a>
                </li>
              </ul>
            </nav>
          </div>
        </div>

      </div>

    </div>

    <script src="./script.js"></script>
    <script src="../auth.js"></script>
    <script src="../utils.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // PHẦN ID 8 SỐ
        //  hàm kiểm tra format ID
    function validateSoID(idValue) {
      // Kiểm tra format: 2 ký tự chữ + 8 số
      const idRegex = /^[A-Za-z]{2}\d{8}$/;
      return idRegex.test(idValue);
    }
    
    // Sửa text mô tả
    const idDescription = document.querySelector('#nhapSoID').closest('.mb-3').querySelector('small');
    if (idDescription) {
      idDescription.textContent = 'Ví dụ: AB12345678 (2 ký tự chữ + 8 số)';
    }
    
    // ===== MỚI: XỬ LÝ SỰ KIỆN INPUT CHO SỐ ID =====
    document.getElementById('inputSoID').addEventListener('input', function() {
      let value = this.value.toUpperCase(); // Chuyển thành chữ hoa
      let cursorPosition = this.selectionStart;
      
      // Xử lý theo vị trí: 2 ký tự chữ đầu + 8 số sau
      let finalValue = '';
      
      for (let i = 0; i < value.length && finalValue.length < 10; i++) {
        if (finalValue.length < 2) {
          // 2 vị trí đầu: chỉ nhận chữ
          if (/[A-Z]/.test(value[i])) {
            finalValue += value[i];
          }
        } else {
          // 8 vị trí sau: chỉ nhận số
          if (/[0-9]/.test(value[i])) {
            finalValue += value[i];
          }
        }
      }
      
      // Cập nhật giá trị nếu thay đổi
      if (this.value !== finalValue) {
        this.value = finalValue;
        
        // Điều chỉnh vị trí con trỏ
        const newCursorPosition = Math.min(cursorPosition, finalValue.length);
        this.setSelectionRange(newCursorPosition, newCursorPosition);
      }
      
      // Kiểm tra validation
      if (this.value && !validateSoID(this.value)) {
        this.classList.add('is-invalid');
        // Tạo thông báo lỗi nếu chưa có
        if (!this.nextElementSibling || !this.nextElementSibling.classList.contains('invalid-feedback')) {
          const feedback = document.createElement('div');
          feedback.classList.add('invalid-feedback');
          feedback.textContent = 'ID phải có 2 ký tự chữ + 8 số (VD: AB12345678)';
          this.after(feedback);
        }
      } else {
        this.classList.remove('is-invalid');
        // Xóa thông báo lỗi nếu có
        const feedback = this.nextElementSibling;
        if (feedback && feedback.classList.contains('invalid-feedback')) {
          feedback.remove();
        }
      }
    });
    
    // ===== MỚI: XỬ LÝ SỰ KIỆN KEYDOWN CHO SỐ ID =====
    document.getElementById('inputSoID').addEventListener('keydown', function(e) {
      const cursorPos = this.selectionStart;
      const cursorEnd = this.selectionEnd;
      const currentValue = this.value;
      
      // Các phím điều khiển được phép
      const allowedKeys = [
        'Backspace', 'Delete', 'Tab', 'Enter', 'Escape',
        'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown',
        'Home', 'End', 'PageUp', 'PageDown'
      ];
    
      // Cho phép Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X
      if (e.ctrlKey && ['a', 'c', 'v', 'x'].includes(e.key.toLowerCase())) {
        return;
      }
    
      // Cho phép các phím điều khiển
      if (allowedKeys.includes(e.key)) {
        return;
      }
    
      // Nếu đang ở vị trí 0-1 (phần chữ)
      if (cursorPos < 2 && cursorPos === cursorEnd) {
        // Chỉ cho phép nhập chữ
        if (!/^[A-Za-z]$/.test(e.key)) {
          e.preventDefault();
          return;
        }
        
        // Kiểm tra giới hạn 2 ký tự chữ
        if (cursorPos >= 2) {
          e.preventDefault();
          return;
        }
      }
      
      // Nếu đang ở vị trí 2+ (phần số)
      if (cursorPos >= 2 && cursorPos === cursorEnd) {
        // Chỉ cho phép nhập số
        if (!/^[0-9]$/.test(e.key)) {
          e.preventDefault();
          return;
        }
        
        // Kiểm tra giới hạn 8 số (tổng cộng 10 ký tự)
        if (currentValue.length >= 10) {
          e.preventDefault();
          return;
        }
      }
    });
    
    // ===== MỚI: XỬ LÝ SỰ KIỆN PASTE CHO SỐ ID =====
    document.getElementById('inputSoID').addEventListener('paste', function(e) {
      e.preventDefault();
      
      // Lấy văn bản được dán
      const pastedText = (e.clipboardData || window.clipboardData).getData('text').toUpperCase();
      
      // Xử lý theo vị trí: 2 chữ + 8 số
      let finalValue = '';
      
      for (let i = 0; i < pastedText.length && finalValue.length < 10; i++) {
        if (finalValue.length < 2) {
          // 2 vị trí đầu: chỉ nhận chữ
          if (/[A-Z]/.test(pastedText[i])) {
            finalValue += pastedText[i];
          }
        } else {
          // 8 vị trí sau: chỉ nhận số
          if (/[0-9]/.test(pastedText[i])) {
            finalValue += pastedText[i];
          }
        }
      }
      
      // Cập nhật giá trị
      this.value = finalValue;
      
      // Đặt con trỏ ở cuối
      this.setSelectionRange(finalValue.length, finalValue.length);
      
      // Kích hoạt sự kiện input để kiểm tra validation
      this.dispatchEvent(new Event('input'));
    });
      </script>
  </body>

</html>